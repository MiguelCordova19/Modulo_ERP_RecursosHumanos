<!-- Header del módulo -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-users me-2 text-primary"></i>
        TRABAJADOR
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <button type="button" class="btn btn-secondary me-2 btn-exportar-trabajadores">
            <i class="fas fa-file-export me-1"></i>
            Exportar
        </button>
        <button type="button" class="btn btn-primary btn-nuevo-trabajador">
            <i class="fas fa-plus me-1"></i>
            Nuevo
        </button>
    </div>
</div>

<!-- Filtros superiores -->
<div class="card shadow-sm mb-3">
    <div class="card-body py-2">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label class="col-form-label col-form-label-sm">Situación</label>
            </div>
            <div class="col-auto">
                <select class="form-select form-select-sm" id="filtroSituacion" style="width: 150px;">
                    <option value="">TODOS</option>
                    <option value="ACTIVO">ACTIVO</option>
                    <option value="BAJA">BAJA</option>
                    <option value="SUSPENDIDO">SUSPENDIDO</option>
                </select>
            </div>
            <div class="col-auto ms-auto">
                <button type="button" class="btn btn-sm btn-outline-secondary btn-consultar-trabajadores">
                    <i class="fas fa-search me-1"></i>
                    Consultar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Tabla de trabajadores -->
<div class="card shadow-sm">
    <div class="card-body p-2">
        <div class="table-responsive">
            <table id="tablaTrabajadores" class="table table-striped table-bordered table-hover dt-module-table" style="width:100%;">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Sede</th>
                        <th>En</th>
                        <th>Tipo Doc.</th>
                        <th>N. Doc.</th>
                        <th>Apellidos y Nombres</th>
                        <th>Sexo</th>
                        <th>F. Nac.</th>
                        <th>F. Ingreso</th>
                        <th>Puesto</th>
                        <th>Régimen Laboral</th>
                        <th>Reg. Pensionario</th>
                        <th>F. Cese</th>
                        <th>Situación</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Los datos se cargarán dinámicamente -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para Nuevo/Editar Trabajador -->
<div class="modal fade" id="modalTrabajador" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold" id="modalTrabajadorTitle" style="color: #333;">
                    Nuevo Trabajador
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body pt-2">
                <!-- Pestañas de navegación -->
                <ul class="nav nav-tabs mb-3" id="tabsTrabajador" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab-datos-personales" data-bs-toggle="tab" data-bs-target="#panel-datos-personales" type="button" role="tab">
                            <i class="fas fa-user me-1"></i>
                            Datos Personales
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-datos-laborales" data-bs-toggle="tab" data-bs-target="#panel-datos-laborales" type="button" role="tab">
                            <i class="fas fa-briefcase me-1"></i>
                            Datos Laborales
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-datos-pension" data-bs-toggle="tab" data-bs-target="#panel-datos-pension" type="button" role="tab">
                            <i class="fas fa-landmark me-1"></i>
                            Datos de Pensión
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-remuneracion" data-bs-toggle="tab" data-bs-target="#panel-remuneracion" type="button" role="tab">
                            <i class="fas fa-money-bill-wave me-1"></i>
                            Remuneración
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-cts" data-bs-toggle="tab" data-bs-target="#panel-cts" type="button" role="tab">
                            <i class="fas fa-piggy-bank me-1"></i>
                            CTS
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-adjuntos" data-bs-toggle="tab" data-bs-target="#panel-adjuntos" type="button" role="tab">
                            <i class="fas fa-paperclip me-1"></i>
                            Adjuntos
                        </button>
                    </li>
                </ul>

                <!-- Contenido de las pestañas -->
                <div class="tab-content" id="tabsTrabajadorContent">
                    <!-- Pestaña: Datos Personales -->
                    <div class="tab-pane fade show active" id="panel-datos-personales" role="tabpanel">
                        <form id="formDatosPersonales">
                            <input type="hidden" id="trabajadorId">
                            
                            <!-- Fila 1: En -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label class="form-label fw-bold" style="color: #666;">
                                        En <span class="text-danger">*</span>
                                    </label>
                                    <input type="hidden" id="tipoTrabajador" name="tipoTrabajador" value="01" required>
                                    <div class="btn-group w-100" role="group" aria-label="Tipo de Trabajador">
                                        <input type="radio" class="btn-check" name="radioTipoTrabajador" id="radioPlanilla" value="01" checked autocomplete="off">
                                        <label class="btn btn-outline-primary" for="radioPlanilla">
                                            <i class="fas fa-briefcase me-1"></i>PLANILLA
                                        </label>
                                        
                                        <input type="radio" class="btn-check" name="radioTipoTrabajador" id="radioRRHH" value="02" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="radioRRHH">
                                            <i class="fas fa-users me-1"></i>RRHH
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Fila 2: Tipo Documento y Nro. Documento -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="tipoDocumento" class="form-label" style="color: #666;">
                                        Tipo Documento <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="tipoDocumento" required>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                                <div class="col-md-8">
                                    <label for="nroDocumento" class="form-label" style="color: #666;">
                                        Nro. Documento <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="nroDocumento" required maxlength="20">
                                </div>
                            </div>

                            <!-- Fila 3: Apellidos y Nombres -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="apPaterno" class="form-label" style="color: #666;">
                                        Ap. Paterno <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="apPaterno" required maxlength="50">
                                </div>
                                <div class="col-md-4">
                                    <label for="apMaterno" class="form-label" style="color: #666;">Ap. Materno</label>
                                    <input type="text" class="form-control" id="apMaterno" maxlength="50">
                                </div>
                                <div class="col-md-4">
                                    <label for="nombres" class="form-label" style="color: #666;">
                                        Nombres <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="nombres" required maxlength="50">
                                </div>
                            </div>

                            <!-- Fila 4: Contacto -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="telefono" class="form-label" style="color: #666;">
                                        Nro. Teléfono/Celular <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="telefono" required maxlength="20">
                                </div>
                                <div class="col-md-4">
                                    <label for="correo" class="form-label" style="color: #666;">
                                        Correo <span class="text-danger">*</span>
                                    </label>
                                    <input type="email" class="form-control" id="correo" required maxlength="50">
                                </div>
                                <div class="col-md-4">
                                    <label for="fechaNacimiento" class="form-label" style="color: #666;">
                                        F. Nacimiento <span class="text-danger">*</span>
                                    </label>
                                    <input type="date" class="form-control" id="fechaNacimiento" required>
                                </div>
                            </div>

                            <!-- Fila 5: Datos adicionales -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="sexo" class="form-label" style="color: #666;">Sexo</label>
                                    <select class="form-select" id="sexo">
                                        <option value="">Seleccione...</option>
                                        <option value="MASCULINO">MASCULINO</option>
                                        <option value="FEMENINO">FEMENINO</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="estadoCivil" class="form-label" style="color: #666;">Estado Civil</label>
                                    <select class="form-select" id="estadoCivil">
                                        <option value="">Seleccione...</option>
                                        <option value="SOLTERO">SOLTERO</option>
                                        <option value="CASADO">CASADO</option>
                                        <option value="DIVORCIADO">DIVORCIADO</option>
                                        <option value="VIUDO">VIUDO</option>
                                        <option value="CONVIVIENTE">CONVIVIENTE</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="regimenLaboral" class="form-label" style="color: #666;">Régimen Laboral</label>
                                    <select class="form-select" id="regimenLaboral">
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Datos Laborales -->
                    <div class="tab-pane fade" id="panel-datos-laborales" role="tabpanel">
                        <form id="formDatosLaborales">
                            <!-- Fila 1: Fecha Ingreso, Sede, Puesto -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="fechaIngresoLaboral" class="form-label" style="color: #666;">Fecha Ingreso Laboral</label>
                                    <input type="date" class="form-control" id="fechaIngresoLaboral" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="sede" class="form-label" style="color: #666;">Sede</label>
                                    <input type="text" class="form-control" id="sede" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="puesto" class="form-label" style="color: #666;">Puesto</label>
                                    <input type="text" class="form-control" id="puesto" readonly>
                                </div>
                            </div>

                            <!-- Fila 2: Turno, Horario, Día Descanso -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="turno" class="form-label" style="color: #666;">Turno</label>
                                    <select class="form-select" id="turno" disabled>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="horario" class="form-label" style="color: #666;">Horario</label>
                                    <select class="form-select" id="horario" disabled>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="diaDescanso" class="form-label" style="color: #666;">Día Descanso</label>
                                    <select class="form-select" id="diaDescanso" disabled>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Fila 3: H. Entrada, H. Salida -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="horaEntrada" class="form-label" style="color: #666;">
                                        <i class="fas fa-clock me-1"></i>H. Entrada
                                    </label>
                                    <input type="time" class="form-control" id="horaEntrada" readonly>
                                    <small class="form-text text-muted">Formato 24 horas (ej: 08:00)</small>
                                </div>
                                <div class="col-md-6">
                                    <label for="horaSalida" class="form-label" style="color: #666;">
                                        <i class="fas fa-clock me-1"></i>H. Salida
                                    </label>
                                    <input type="time" class="form-control" id="horaSalida" readonly>
                                    <small class="form-text text-muted">Formato 24 horas (ej: 17:00)</small>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                Los datos laborales son de solo lectura. Se actualizan automáticamente según la configuración del sistema.
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Datos de Pensión -->
                    <div class="tab-pane fade" id="panel-datos-pension" role="tabpanel">
                        <form id="formDatosPension">
                            <!-- Régimen Pensionario -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="regimenPensionario" class="form-label" style="color: #666;">Régimen Pensionario</label>
                                    <input type="text" class="form-control" id="regimenPensionario" readonly>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                Los datos de pensión son de solo lectura. Se actualizan automáticamente según la configuración del sistema.
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Remuneración -->
                    <div class="tab-pane fade" id="panel-remuneracion" role="tabpanel">
                        <form id="formRemuneracion">
                            <!-- Fila 1: Tipo Pago, Banco, Tipo Cuenta -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="tipoPago" class="form-label" style="color: #666;">
                                        Tipo Pago <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="tipoPago" required>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="banco" class="form-label" style="color: #666;">
                                        Banco <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="banco" required>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="tipoCuenta" class="form-label" style="color: #666;">
                                        Tipo Cuenta <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="tipoCuenta" required>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Fila 2: N. Cuenta -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="numeroCuenta" class="form-label" style="color: #666;">
                                        N. Cuenta <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="numeroCuenta" required 
                                           maxlength="20" minlength="10" 
                                           pattern="[0-9-]+" 
                                           placeholder="10-20 dígitos (puede incluir guiones)">
                                    <small class="form-text text-muted">Solo números y guiones. Mínimo 10, máximo 20 dígitos.</small>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: CTS -->
                    <div class="tab-pane fade" id="panel-cts" role="tabpanel">
                        <form id="formCTS">
                            <!-- Fila 1: Banco y N. Cuenta -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="ctsBanco" class="form-label" style="color: #666;">
                                        Banco <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="ctsBanco" required>
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="ctsNumeroCuenta" class="form-label" style="color: #666;">
                                        N. Cuenta <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="ctsNumeroCuenta" required 
                                           maxlength="20" minlength="10" 
                                           pattern="[0-9-]+" 
                                           placeholder="10-20 dígitos (puede incluir guiones)">
                                    <small class="form-text text-muted">Solo números y guiones. Mínimo 10, máximo 20 dígitos.</small>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                La cuenta CTS (Compensación por Tiempo de Servicios) es donde se depositarán los beneficios sociales del trabajador.
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Adjuntos -->
                    <div class="tab-pane fade" id="panel-adjuntos" role="tabpanel">
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary btn-sm btn-nuevo-adjunto">
                                <i class="fas fa-plus me-1"></i>
                                Nuevo Adjunto
                            </button>
                        </div>

                        <div class="table-responsive">
                            <table id="tablaAdjuntos" class="table table-striped table-bordered table-hover" style="width:100%; font-size: 12px;">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">#</th>
                                        <th style="width: 200px;">Descripción</th>
                                        <th style="width: 200px;">Archivo</th>
                                        <th style="width: 120px;">Fecha</th>
                                        <th style="width: 100px;">Estado</th>
                                        <th style="width: 80px;">
                                            <i class="fas fa-cog"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            No hay datos disponibles
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <div style="font-size: 12px;">
                                Mostrando 0 a 0 de 0 registros
                            </div>
                            <div>
                                <button class="btn btn-sm btn-secondary" disabled>Anterior</button>
                                <button class="btn btn-sm btn-secondary" disabled>Siguiente</button>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            Puede adjuntar documentos en formato PDF como: CV, certificados, contratos, etc.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-guardar-trabajador" style="background-color: #ff8c00; border-color: #ff8c00; color: white;">
                    <i class="fas fa-save me-1"></i>
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Nuevo Adjunto -->
<div class="modal fade" id="modalAdjunto" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-2">
                <h5 class="modal-title fw-bold w-100 text-center" style="color: #333;">
                    Nuevo Adjunto
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body pt-2">
                <form id="formAdjunto">
                    <div class="mb-3">
                        <label for="descripcionAdjunto" class="form-label" style="color: #666;">
                            Descripción del Adjunto
                        </label>
                        <textarea class="form-control" id="descripcionAdjunto" rows="3" 
                                  placeholder="Ingrese la descripción del adjunto" required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="archivoAdjunto" class="form-label" style="color: #666;">
                            Seleccionar Archivo PDF
                        </label>
                        <input type="file" class="form-control" id="archivoAdjunto" accept=".pdf" required>
                        <small class="text-muted">Solo se permiten archivos PDF</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-guardar-adjunto" style="background-color: #ff8c00; border-color: #ff8c00; color: white;">
                    <i class="fas fa-save me-1"></i>
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CSS y Scripts -->
<link rel="stylesheet" href="/css/modules/module-tables.css">
<script>
    // Esperar a que jQuery, DataTables y el módulo trabajador estén disponibles
    (function initTrabajador() {
        if (typeof jQuery === 'undefined' || typeof $.fn.DataTable === 'undefined') {
            console.log('⏳ Esperando jQuery y DataTables...');
            setTimeout(initTrabajador, 100);
            return;
        }
        
        console.log('✅ jQuery y DataTables disponibles');
        
        // Inicializar el módulo
        if (typeof window.trabajador !== 'undefined') {
            console.log('✅ Módulo trabajador encontrado, inicializando...');
            window.trabajador.init();
        } else {
            console.log('✅ Módulo trabajador ya existe, inicializando...');
            window.trabajador.init();
        }
    })();
</script>
