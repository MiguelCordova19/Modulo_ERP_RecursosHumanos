<!-- Header del módulo -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-users me-2 text-primary"></i>
        TRABAJADOR
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <button type="button" class="btn btn-secondary me-2 btn-exportar-trabajadores">
            <i class="fas fa-file-export me-1"></i>
            Exportar
        </button>
        <button type="button" class="btn btn-primary btn-nuevo-trabajador">
            <i class="fas fa-plus me-1"></i>
            Nuevo
        </button>
    </div>
</div>

<!-- Filtros superiores -->
<div class="card shadow-sm mb-3">
    <div class="card-body py-2">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label class="col-form-label col-form-label-sm">Situación</label>
            </div>
            <div class="col-auto">
                <select class="form-select form-select-sm" id="filtroSituacion" style="width: 150px;">
                    <option value="">TODOS</option>
                    <option value="ACTIVO">ACTIVO</option>
                    <option value="BAJA">BAJA</option>
                    <option value="SUSPENDIDO">SUSPENDIDO</option>
                </select>
            </div>
            <div class="col-auto ms-auto">
                <button type="button" class="btn btn-sm btn-outline-secondary btn-consultar-trabajadores">
                    <i class="fas fa-search me-1"></i>
                    Consultar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Tabla de trabajadores -->
<div class="card shadow-sm">
    <div class="card-body p-2">
        <div class="table-responsive">
            <table id="tablaTrabajadores" class="table table-striped table-bordered table-hover dt-module-table" style="width:100%; font-size: 11px;">
                <thead>
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th style="width: 80px;">Sede</th>
                        <th style="width: 50px;">En</th>
                        <th style="width: 60px;">Tipo Doc.</th>
                        <th style="width: 90px;">N. Doc.</th>
                        <th style="width: 200px;">Apellidos y Nombres</th>
                        <th style="width: 70px;">Sexo</th>
                        <th style="width: 80px;">F. Nac.</th>
                        <th style="width: 80px;">F. Ingreso</th>
                        <th style="width: 120px;">Puesto</th>
                        <th style="width: 120px;">Régimen Laboral</th>
                        <th style="width: 100px;">Reg. Pensionario</th>
                        <th style="width: 80px;">F. Cese</th>
                        <th style="width: 80px;">Situación</th>
                        <th style="width: 60px;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Los datos se cargarán dinámicamente -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para Nuevo/Editar Trabajador -->
<div class="modal fade" id="modalTrabajador" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold" id="modalTrabajadorTitle" style="color: #333;">
                    Nuevo Trabajador
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body pt-2">
                <!-- Pestañas de navegación -->
                <ul class="nav nav-tabs mb-3" id="tabsTrabajador" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab-datos-personales" data-bs-toggle="tab" data-bs-target="#panel-datos-personales" type="button" role="tab">
                            <i class="fas fa-user me-1"></i>
                            Datos Personales
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-datos-laborales" data-bs-toggle="tab" data-bs-target="#panel-datos-laborales" type="button" role="tab">
                            <i class="fas fa-briefcase me-1"></i>
                            Datos Laborales
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-datos-pension" data-bs-toggle="tab" data-bs-target="#panel-datos-pension" type="button" role="tab">
                            <i class="fas fa-landmark me-1"></i>
                            Datos de Pensión
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-remuneracion" data-bs-toggle="tab" data-bs-target="#panel-remuneracion" type="button" role="tab">
                            <i class="fas fa-money-bill-wave me-1"></i>
                            Remuneración
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-cts" data-bs-toggle="tab" data-bs-target="#panel-cts" type="button" role="tab">
                            <i class="fas fa-piggy-bank me-1"></i>
                            CTS
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-adjuntos" data-bs-toggle="tab" data-bs-target="#panel-adjuntos" type="button" role="tab">
                            <i class="fas fa-paperclip me-1"></i>
                            Adjuntos
                        </button>
                    </li>
                </ul>

                <!-- Contenido de las pestañas -->
                <div class="tab-content" id="tabsTrabajadorContent">
                    <!-- Pestaña: Datos Personales -->
                    <div class="tab-pane fade show active" id="panel-datos-personales" role="tabpanel">
                        <form id="formDatosPersonales">
                            <input type="hidden" id="trabajadorId">
                            
                            <!-- Fila 1: En -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label class="form-label fw-bold" style="color: #666;">En</label>
                                    <div class="d-flex gap-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="en" id="enPlanilla" value="PLANILLA" checked>
                                            <label class="form-check-label" for="enPlanilla">
                                                PLANILLA
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="en" id="enRRHH" value="RRHH">
                                            <label class="form-check-label" for="enRRHH">
                                                RRHH
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Fila 2: Tipo Documento y Nro. Documento -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="tipoDocumento" class="form-label" style="color: #666;">Tipo Documento</label>
                                    <select class="form-select" id="tipoDocumento" required>
                                        <option value="">Seleccione...</option>
                                        <option value="DNI">DNI</option>
                                        <option value="CE">Carnet de Extranjería</option>
                                        <option value="PASAPORTE">Pasaporte</option>
                                    </select>
                                </div>
                                <div class="col-md-8">
                                    <label for="nroDocumento" class="form-label" style="color: #666;">Nro. Documento</label>
                                    <input type="text" class="form-control" id="nroDocumento" required>
                                </div>
                            </div>

                            <!-- Fila 3: Apellidos y Nombres -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="apPaterno" class="form-label" style="color: #666;">Ap. Paterno</label>
                                    <input type="text" class="form-control" id="apPaterno" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="apMaterno" class="form-label" style="color: #666;">Ap. Materno</label>
                                    <input type="text" class="form-control" id="apMaterno" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="nombres" class="form-label" style="color: #666;">Nombres</label>
                                    <input type="text" class="form-control" id="nombres" required>
                                </div>
                            </div>

                            <!-- Fila 4: Contacto -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="telefono" class="form-label" style="color: #666;">Nro. Teléfono/Celular</label>
                                    <input type="text" class="form-control" id="telefono">
                                </div>
                                <div class="col-md-4">
                                    <label for="correo" class="form-label" style="color: #666;">Correo</label>
                                    <input type="email" class="form-control" id="correo">
                                </div>
                                <div class="col-md-4">
                                    <label for="fechaNacimiento" class="form-label" style="color: #666;">F. Nacimiento</label>
                                    <input type="date" class="form-control" id="fechaNacimiento">
                                </div>
                            </div>

                            <!-- Fila 5: Datos adicionales -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="sexo" class="form-label" style="color: #666;">Sexo</label>
                                    <select class="form-select" id="sexo">
                                        <option value="">Seleccione...</option>
                                        <option value="MASCULINO">MASCULINO</option>
                                        <option value="FEMENINO">FEMENINO</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="estadoCivil" class="form-label" style="color: #666;">Estado Civil</label>
                                    <select class="form-select" id="estadoCivil">
                                        <option value="">Seleccione...</option>
                                        <option value="SOLTERO">SOLTERO</option>
                                        <option value="CASADO">CASADO</option>
                                        <option value="DIVORCIADO">DIVORCIADO</option>
                                        <option value="VIUDO">VIUDO</option>
                                        <option value="CONVIVIENTE">CONVIVIENTE</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="regimenLaboral" class="form-label" style="color: #666;">Régimen Laboral</label>
                                    <select class="form-select" id="regimenLaboral">
                                        <option value="">Seleccione...</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Datos Laborales -->
                    <div class="tab-pane fade" id="panel-datos-laborales" role="tabpanel">
                        <form id="formDatosLaborales">
                            <!-- Fila 1: Fecha Ingreso, Sede, Puesto -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="fechaIngresoLaboral" class="form-label" style="color: #666;">Fecha Ingreso Laboral</label>
                                    <input type="date" class="form-control" id="fechaIngresoLaboral" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="sede" class="form-label" style="color: #666;">Sede</label>
                                    <input type="text" class="form-control" id="sede" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="puesto" class="form-label" style="color: #666;">Puesto</label>
                                    <input type="text" class="form-control" id="puesto" readonly>
                                </div>
                            </div>

                            <!-- Fila 2: Turno, Horario, Día Descanso -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="turno" class="form-label" style="color: #666;">Turno</label>
                                    <input type="text" class="form-control" id="turno" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="horario" class="form-label" style="color: #666;">Horario</label>
                                    <input type="text" class="form-control" id="horario" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="diaDescanso" class="form-label" style="color: #666;">Día Descanso</label>
                                    <input type="text" class="form-control" id="diaDescanso" readonly>
                                </div>
                            </div>

                            <!-- Fila 3: H. Entrada, H. Salida -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="horaEntrada" class="form-label" style="color: #666;">H. Entrada</label>
                                    <input type="text" class="form-control" id="horaEntrada" placeholder="--:--" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label for="horaSalida" class="form-label" style="color: #666;">H. Salida</label>
                                    <input type="text" class="form-control" id="horaSalida" placeholder="--:--" readonly>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                Los datos laborales son de solo lectura. Se actualizan automáticamente según la configuración del sistema.
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Datos de Pensión -->
                    <div class="tab-pane fade" id="panel-datos-pension" role="tabpanel">
                        <form id="formDatosPension">
                            <!-- Régimen Pensionario -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="regimenPensionario" class="form-label" style="color: #666;">Régimen Pensionario</label>
                                    <input type="text" class="form-control" id="regimenPensionario" readonly>
                                </div>
                            </div>

                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                Los datos de pensión son de solo lectura. Se actualizan automáticamente según la configuración del sistema.
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Remuneración -->
                    <div class="tab-pane fade" id="panel-remuneracion" role="tabpanel">
                        <form id="formRemuneracion">
                            <!-- Fila 1: Tipo Pago, Banco, Tipo Cuenta -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="tipoPago" class="form-label" style="color: #666;">Tipo Pago</label>
                                    <select class="form-select" id="tipoPago">
                                        <option value="">Seleccione...</option>
                                        <option value="EFECTIVO">Efectivo</option>
                                        <option value="DEPOSITO">Depósito Bancario</option>
                                        <option value="TRANSFERENCIA">Transferencia</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="banco" class="form-label" style="color: #666;">Banco</label>
                                    <select class="form-select" id="banco">
                                        <option value="">Seleccione...</option>
                                        <option value="BCP">Banco de Crédito del Perú</option>
                                        <option value="BBVA">BBVA</option>
                                        <option value="INTERBANK">Interbank</option>
                                        <option value="SCOTIABANK">Scotiabank</option>
                                        <option value="BANBIF">BanBif</option>
                                        <option value="PICHINCHA">Banco Pichincha</option>
                                        <option value="OTROS">Otros</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="tipoCuenta" class="form-label" style="color: #666;">Tipo Cuenta</label>
                                    <select class="form-select" id="tipoCuenta">
                                        <option value="">Seleccione...</option>
                                        <option value="AHORROS">Ahorros</option>
                                        <option value="CORRIENTE">Corriente</option>
                                        <option value="CCI">CCI</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Fila 2: N. Cuenta -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="numeroCuenta" class="form-label" style="color: #666;">N. Cuenta</label>
                                    <input type="text" class="form-control" id="numeroCuenta" placeholder="Ingrese el número de cuenta">
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: CTS -->
                    <div class="tab-pane fade" id="panel-cts" role="tabpanel">
                        <form id="formCTS">
                            <!-- Fila 1: Banco y N. Cuenta -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="ctsBanco" class="form-label" style="color: #666;">Banco</label>
                                    <select class="form-select" id="ctsBanco">
                                        <option value="">Seleccione...</option>
                                        <option value="BCP">Banco de Crédito del Perú</option>
                                        <option value="BBVA">BBVA</option>
                                        <option value="INTERBANK">Interbank</option>
                                        <option value="SCOTIABANK">Scotiabank</option>
                                        <option value="BANBIF">BanBif</option>
                                        <option value="PICHINCHA">Banco Pichincha</option>
                                        <option value="OTROS">Otros</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="ctsNumeroCuenta" class="form-label" style="color: #666;">N. Cuenta</label>
                                    <input type="text" class="form-control" id="ctsNumeroCuenta" placeholder="Ingrese el número de cuenta CTS">
                                </div>
                            </div>

                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                La cuenta CTS (Compensación por Tiempo de Servicios) es donde se depositarán los beneficios sociales del trabajador.
                            </div>
                        </form>
                    </div>

                    <!-- Pestaña: Adjuntos -->
                    <div class="tab-pane fade" id="panel-adjuntos" role="tabpanel">
                        <div class="mb-3">
                            <button type="button" class="btn btn-primary btn-sm btn-nuevo-adjunto">
                                <i class="fas fa-plus me-1"></i>
                                Nuevo Adjunto
                            </button>
                        </div>

                        <div class="table-responsive">
                            <table id="tablaAdjuntos" class="table table-striped table-bordered table-hover" style="width:100%; font-size: 12px;">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">#</th>
                                        <th style="width: 200px;">Descripción</th>
                                        <th style="width: 200px;">Archivo</th>
                                        <th style="width: 120px;">Fecha</th>
                                        <th style="width: 100px;">Estado</th>
                                        <th style="width: 80px;">
                                            <i class="fas fa-cog"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            No hay datos disponibles
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <div style="font-size: 12px;">
                                Mostrando 0 a 0 de 0 registros
                            </div>
                            <div>
                                <button class="btn btn-sm btn-secondary" disabled>Anterior</button>
                                <button class="btn btn-sm btn-secondary" disabled>Siguiente</button>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            Puede adjuntar documentos en formato PDF como: CV, certificados, contratos, etc.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-guardar-trabajador" style="background-color: #ff8c00; border-color: #ff8c00; color: white;">
                    <i class="fas fa-save me-1"></i>
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Nuevo Adjunto -->
<div class="modal fade" id="modalAdjunto" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-2">
                <h5 class="modal-title fw-bold w-100 text-center" style="color: #333;">
                    Nuevo Adjunto
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body pt-2">
                <form id="formAdjunto">
                    <div class="mb-3">
                        <label for="descripcionAdjunto" class="form-label" style="color: #666;">
                            Descripción del Adjunto
                        </label>
                        <textarea class="form-control" id="descripcionAdjunto" rows="3" 
                                  placeholder="Ingrese la descripción del adjunto" required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="archivoAdjunto" class="form-label" style="color: #666;">
                            Seleccionar Archivo PDF
                        </label>
                        <input type="file" class="form-control" id="archivoAdjunto" accept=".pdf" required>
                        <small class="text-muted">Solo se permiten archivos PDF</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-guardar-adjunto" style="background-color: #ff8c00; border-color: #ff8c00; color: white;">
                    <i class="fas fa-save me-1"></i>
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CSS y Scripts -->
<link rel="stylesheet" href="/css/modules/module-tables.css">
<style>
    /* Estilos específicos para tabla de trabajadores */
    #tablaTrabajadores {
        font-size: 11px !important;
    }
    
    #tablaTrabajadores thead th {
        font-size: 11px !important;
        padding: 8px 4px !important;
        white-space: nowrap;
    }
    
    #tablaTrabajadores tbody td {
        font-size: 11px !important;
        padding: 6px 4px !important;
        white-space: nowrap;
    }
    
    #tablaTrabajadores thead tr.filters input {
        font-size: 10px !important;
        padding: 2px 4px !important;
    }
    
    /* Hacer los controles de DataTables más pequeños */
    #tablaTrabajadores_wrapper .dataTables_length,
    #tablaTrabajadores_wrapper .dataTables_info,
    #tablaTrabajadores_wrapper .dataTables_paginate {
        font-size: 11px !important;
    }
    
    #tablaTrabajadores_wrapper .dataTables_length select {
        font-size: 11px !important;
        padding: 2px 6px !important;
        height: 24px !important;
    }
</style>
<script src="/js/modules/trabajador.js"></script>
<script>
    // Esperar a que jQuery y DataTables estén disponibles
    (function initTrabajador() {
        if (typeof jQuery === 'undefined' || typeof $.fn.DataTable === 'undefined') {
            console.log('⏳ Esperando jQuery y DataTables...');
            setTimeout(initTrabajador, 100);
            return;
        }
        
        console.log('✅ jQuery y DataTables disponibles, inicializando módulo Trabajador');
        
        $(document).ready(function() {
            if (typeof trabajador !== 'undefined') {
                trabajador.init();
            } else {
                console.error('❌ Módulo trabajador no encontrado');
            }
        });
    })();
</script>
